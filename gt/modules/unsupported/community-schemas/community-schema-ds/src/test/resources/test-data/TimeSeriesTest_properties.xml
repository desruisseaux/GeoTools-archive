<?xml version="1.0" encoding="UTF-8"?>
<!-- 
  TimeSeriesTest mapping file
-->
<c:ComplexDataStore xmlns:c="http://www.geotools.org/complex" xmlns:ogc="http://www.opengis.net/ogc"
  xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.geotools.org/complex ComplexDataStore.xsd
                      http://www.opengis.net/ogc http://schemas.opengis.net/filter/1.1.0/expr.xsd">
  <namespaces>
    <!-- 
      declare here the namespaces and prefixes used by the parser to
      resolve <type> elements. 
    -->

    <Namespace>
      <prefix>aw</prefix>
      <uri>http://brs.gov.au/awdip/0.2</uri>
    </Namespace>
    <Namespace>
      <prefix>gmd</prefix>
      <uri>http://www.isotc211.org/2005/gmd</uri>
    </Namespace>

    <Namespace>
      <prefix>sa</prefix>
      <uri>http://www.seegrid.csiro.au/xml/sampling/0.0</uri>
    </Namespace>

    <Namespace>
      <prefix>swe</prefix>
      <uri>http://www.opengis.net/swe</uri>
    </Namespace>

    <Namespace>
      <prefix>gco</prefix>
      <uri>http://www.isotc211.org/2005/gco</uri>
    </Namespace>
  </namespaces>
  <sourceDataStores>
    <DataStore>
      <id>timeseries_denormalized</id>
      <parameters>
        <Parameter>
          <name>directory</name>
          <!-- path can be relative to this file if starts with "file: -->
          <value>file:./</value>
        </Parameter>
      </parameters>
    </DataStore>
  </sourceDataStores>
  <targetTypes>
    <FeatureType>
      <!-- 
        State the needed xsd schemas to be loaded in order 
        to make the schema-to-FeatureModel parse.
        Paths are relative to this file, or may be absolute URL's.
        Imports and includes at the schemas will be followed as long
        as they're relative paths.
      -->
      <schemaUri>SampleSite.xsd</schemaUri>
    </FeatureType>
  </targetTypes>
  <typeMappings>
    <FeatureTypeMapping>
      <sourceDataStore>timeseries_denormalized</sourceDataStore>
      <sourceType>timeseries_denormalized</sourceType>
      <targetElement>aw:SiteSinglePhenomTimeSeries</targetElement>
      <groupBy>
        <!-- 
          All source schema attributes except LITHOSTRAT, LITHOLOGY_, BASE_BED_C, DRILLED_D and DRILLED__1 
          are grouping ones, meaning that only those four attributes are going to be treated as multivalued
          from the joined results.
        -->
        <GroupByAttribute>site_id</GroupByAttribute>
        <GroupByAttribute>determinand_code</GroupByAttribute>

      </groupBy>
      <attributeMappings>
        <AttributeMapping>
          <targetAttribute>SiteSinglePhenomTimeSeries</targetAttribute>
          <idExpression>
            <OCQL>site_id</OCQL>
          </idExpression>
        </AttributeMapping>

        <AttributeMapping>
          <targetAttribute>SiteSinglePhenomTimeSeries/name[1]</targetAttribute>
          <sourceExpression>
            <OCQL>site_id</OCQL>
          </sourceExpression>
          <ClientProperty>
            <name>gml:codeSpace</name>
            <value>'http://my.org/identifiers/public'</value>
          </ClientProperty>
        </AttributeMapping>

        <AttributeMapping>
          <targetAttribute>relatedObservation/WaterObservation</targetAttribute>
          <targetAttributeNode>aw:PhenomenonTimeSeriesType</targetAttributeNode>
        </AttributeMapping>

        <!--  shouldnt need this - should be inherited from supertype of WaterObservation
        <AttributeMapping>
          <targetAttribute>relatedObservation/WaterObservation/observedProperty</targetAttribute>
          <targetAttributeNode>swe:PhenomenonPropertyType</targetAttributeNode>
        </AttributeMapping>
        
     <AttributeMapping>
          <targetAttribute>relatedObservation/WaterObservation/observedProperty</targetAttribute>
          <targetAttributeNode>aw:PhenomenonPropertyType</targetAttributeNode>
        </AttributeMapping>

        <AttributeMapping>
          <targetAttribute>relatedObservation/WaterObservation/observedProperty/Phenomenom</targetAttribute>
          <targetAttributeNode>aw:PhenomenonType</targetAttributeNode>

        </AttributeMapping>-->


        <AttributeMapping>
          <targetAttribute>relatedObservation/WaterObservation/observedProperty/Phenomenom/name</targetAttribute>
          <sourceExpression>

            <OCQL>determinand_code</OCQL>
          </sourceExpression>


        </AttributeMapping>
      </attributeMappings>
    </FeatureTypeMapping>
  </typeMappings>
</c:ComplexDataStore>
